# Progress tracking for the Enter-Exit Feature

files_to_be_modified:
  - internal/project/project.go
  - internal/core/session/session.go
  - internal/core/session/session.yaml  # Structure and usage pattern changes
  - internal/core/feature/feature.go    # For state.yaml management
  - internal/mcp/tools/feature.go       # For d3_feature_create, d3_feature_enter, d3_feature_exit
  - internal/cli/command/root.go        # Potentially to add 'd3 exit'
  - internal/cli/command/create.go      # Or equivalent for 'd3 feature create'
  - internal/cli/command/feature_enter.go # New or existing feature subcommand file
  - internal/cli/command/exit.go          # New for 'd3 exit'
  # Test files related to the above will also be modified/created.
  # Documentation files will need updates.

implementation_tasks:
  - id: task_1
    description: "Task 1: Core State & Feature Service Refactoring for Robust Phase Management"
    status: "completed"
    sub_tasks:
      - id: task_1_1
        description: "(Completed) Rename MCP tool d3_create_feature to d3_feature_create and CLI d3 create feature to d3 feature create."
        status: "completed"
      - id: task_1_2
        description: "(Completed) Refactor session.SessionState (session.yml) to remove CurrentPhase, adjust session.Storage Load/Save."
        status: "completed"
      - id: task_1_3
        description: "Enhance FeatureServicer interface and implementation for state.yaml management (GetFeaturePhase, SetFeaturePhase, and state.yaml creation in feature.Service.CreateFeature)."
        status: "completed"
      - id: task_1_4
        description: "Refactor Project.ChangePhase to use FeatureServicer.SetFeaturePhase for state.yaml updates."
        status: "completed"
      - id: task_1_5
        description: "Refactor Project.CreateFeature to rely on FeatureServicer for state.yaml creation and correctly set in-memory/session.yml state."
        status: "completed"
      - id: task_1_6
        description: "Update internal references and documentation for naming and core state/feature service refactorings. (Manual review and update needed by user)"
        status: "todo"
      - id: task_1_7
        description: "Run/update/add tests for FeatureServicer methods, CreateFeature, and ChangePhase. (Manual execution and verification needed by user)"
        status: "completed"
  - id: task_2
    description: "Task 2: Implement Core EnterFeature Logic (using enhanced FeatureServicer)"
    status: "todo"
    sub_tasks:
      - id: task_2_1
        description: "Define/Modify Project.EnterFeature to use FeatureServicer.GetFeaturePhase, update session.yml, set in-memory state, load rules."
        status: "completed"
  - id: task_3
    description: "Task 3: Create MCP Tool d3_feature_enter (relies on updated Task 2)"
    status: "completed"
    sub_tasks:
      - id: task_3_1
        description: "Define d3_feature_enter MCP tool spec with feature_name parameter."
        status: "completed"
      - id: task_3_2
        description: "Implement MCP handler for d3_feature_enter to call core EnterFeature logic and format result."
        status: "completed"
  - id: task_4
    description: "Task 4: Create CLI Command d3 feature enter <feature_name> (relies on updated Task 3)"
    status: "completed"
    sub_tasks:
      - id: task_4_1
        description: "Create/Modify Cobra command enterCmd for d3 feature enter <feature_name>."
        status: "completed"
      - id: task_4_2
        description: "Implement RunE for enterCmd to call d3_feature_enter MCP tool and print result. (MCP call is placeholder)"
        status: "completed"
  - id: task_5
    description: "Task 5: Implement Core ExitFeature Logic (relying on refactored state)"
    status: "todo"
    sub_tasks:
      - id: task_5_1
        description: "Define/Modify Project.ExitFeature to update session.yml (clear CurrentFeature), clear in-memory state, clear rules."
        status: "completed"
  - id: task_6
    description: "Task 6: Create MCP Tool d3_feature_exit (relies on updated Task 5)"
    status: "completed"
    sub_tasks:
      - id: task_6_1
        description: "Define d3_feature_exit MCP tool (no parameters)."
        status: "completed"
      - id: task_6_2
        description: "Implement MCP handler for d3_feature_exit to call core ExitFeature logic and format result."
        status: "completed"
  - id: task_7
    description: "Task 7: Create CLI Command d3 exit (relies on updated Task 6)"
    status: "completed"
    sub_tasks:
      - id: task_7_1
        description: "Create/Modify top-level Cobra command exitCmd for d3 exit."
        status: "completed"
      - id: task_7_2
        description: "Implement RunE for exitCmd to call d3_feature_exit MCP tool and print result. (MCP call is placeholder)"
        status: "completed"
  - id: task_8
    description: "Task 8: Add Unit Tests for New Commands and Tool Handlers"
    status: "completed"
    sub_tasks:
      - id: task_8_1
        description: "Add tests in internal/mcp/tools/tools_test.go for HandleFeatureEnter."
        status: "completed"
      - id: task_8_2
        description: "Add tests in internal/mcp/tools/tools_test.go for HandleFeatureExit."
        status: "completed"
      - id: task_8_3
        description: "Create feature_enter_test.go and add tests for NewFeatureEnterCommand."
        status: "completed"
      - id: task_8_4
        description: "Create exit_test.go and add tests for NewExitCommand."
        status: "completed"
